{% extends 'base.html' %}
{% load static %}

{% block title %}定點機構管理{% endblock %}

{% block stylesheet %}
    <link rel="stylesheet" href="{% static 'css/account/manage.css' %}">
{% endblock %}

{% block navbar-start %}
    <div class="ts-tab" style="">
        <div class="item tab-item" data-href="{% url 'main' %}">
            <span class="ts-icon is-huge is-arrow-left-icon"></span>
        </div>
        <div class="item is-text">定點機構管理</div>
    </div>
{% endblock %}

{% block headline %}
    <div class="ts-content is-tertiary" style="background-color: var(--ts-gray-200)">
        <div class="ts-container has-vertically-spaced" style="--width: 1650px">
            <div class="ts-header is-big is-heavy">定點機構管理</div>
            <div class="ts-text is-secondary">管理產出定點與合作處理/清理機構的地方。</div>
        </div>
    </div>
{% endblock %}

{% block content %}
    {% csrf_token %}

    <div class="ts-container has-vertically-spaced-large" style="--width: 1800px">
        <div class="ts-grid is-evenly-divided is-divided is-relaxed">
            
            <div class="column">
                <div class="ts-grid is-start-aligned-aligned">
                    <div class="column">
                        <button class="ts-button is-positive is-start-icon btn-add-location">
                            <span class="ts-icon is-plus-icon"></span> 新增定點
                        </button>
                        <button class="ts-button is-negative is-start-icon btn-delete-locations" style="display: none;">
                            <span class="ts-icon is-trash-can-icon"></span> 刪除定點
                        </button>
                    </div>
                    <div class="column is-6-wide">
                        <div class="ts-input is-relaxed is-start-icon">
                            <span class="ts-icon is-magnifying-glass-icon"></span>
                            <input type="text" placeholder="搜尋定點...">
                        </div>
                    </div>
                </div>

                <div class="ts-box has-shadow has-vertically-spaced-large">
                    <table class="ts-table is-large is-relaxed is-single-line location-table">
                        <thead>
                            <tr>
                                <th class="checkbox-column"><label class="ts-checkbox is-solo is-large"><input type="checkbox"></label></th>
                                <th>ID</th>
                                <th>定點名稱</th>
                                <th class="action-column" style="text-align: right;">操作</th>
                            </tr>
                        </thead>
                        <tbody>
                            {% for loc in locations %}
                            <tr data-id="{{ loc.id }}">
                                <td><label class="ts-checkbox is-solo is-large"><input type="checkbox" value="{{ loc.id }}"></label></td>
                                <td>{{ loc.id }}</td>
                                <td>{{ loc.name }}</td>
                                <td style="text-align: right;">
                                    <button type="button" class="ts-button is-icon is-warning is-small btn-edit-location" data-id="{{ loc.id }}"><span class="ts-icon is-pencil-icon"></span></button>
                                </td>
                            </tr>
                            {% empty %}
                            <tr>
                                <td colspan="4" style="text-align: center; padding: 40px 0;">
                                    <div class="ts-blankslate is-large" style="border: none;">
                                        <span class="ts-icon is-file-circle-question-icon"></span>
                                        <div class="header">沒有定點資料</div>
                                        <div class="description">請按下上方的「新增定點」按鈕加入。</div>
                                    </div>
                                </td>
                            </tr>
                            {% endfor %}
                        </tbody>
                    </table>
                </div>
            </div>

            <div class="column">
                <div class="ts-grid is-start-aligned-aligned">
                    <div class="column">
                        <button class="ts-button is-positive is-start-icon btn-add-agency">
                            <span class="ts-icon is-plus-icon"></span> 新增機構
                        </button>
                        <button class="ts-button is-negative is-start-icon btn-delete-agencies" style="display: none;">
                            <span class="ts-icon is-trash-can-icon"></span> 刪除機構
                        </button>
                    </div>
                    <div class="column is-6-wide">
                        <div class="ts-input is-relaxed is-start-icon">
                            <span class="ts-icon is-magnifying-glass-icon"></span>
                            <input type="text" placeholder="搜尋機構...">
                        </div>
                    </div>
                </div>

                <div class="ts-box has-shadow has-vertically-spaced-large">
                    <table class="ts-table is-large is-relaxed is-single-line agency-table">
                        <thead>
                            <tr>
                                <th class="checkbox-column"><label class="ts-checkbox is-solo is-large"><input type="checkbox"></label></th>
                                <th>ID</th>
                                <th>機構名稱</th>
                                <th>類型</th>
                                <th class="action-column" style="text-align: right;">操作</th>
                            </tr>
                        </thead>
                        <tbody>
                            {% for agency in clear_agencies %}
                            <tr data-id="clear_{{ agency.id }}">
                                <td><label class="ts-checkbox is-solo is-large"><input type="checkbox" value="clear_{{ agency.id }}"></label></td>
                                <td>{{ agency.id }}</td>
                                <td>{{ agency.name }}</td>
                                <td><span class="ts-badge is-small is-outlined is-info">清理</span></td>
                                <td style="text-align: right;">
                                    <button type="button" class="ts-button is-icon is-warning is-small btn-edit-agency" data-id="clear_{{ agency.id }}"><span class="ts-icon is-pencil-icon"></span></button>
                                </td>
                            </tr>
                            {% endfor %}
                            
                            {% for agency in process_agencies %}
                            <tr data-id="process_{{ agency.id }}">
                                <td><label class="ts-checkbox is-solo is-large"><input type="checkbox" value="process_{{ agency.id }}"></label></td>
                                <td>{{ agency.id }}</td>
                                <td>{{ agency.name }}</td>
                                <td><span class="ts-badge is-small is-outlined is-warning">處理</span></td>
                                <td style="text-align: right;">
                                    <button type="button" class="ts-button is-icon is-warning is-small btn-edit-agency" data-id="process_{{ agency.id }}"><span class="ts-icon is-pencil-icon"></span></button>
                                </td>
                            </tr>
                            {% endfor %}

                            {% if clear_agencies|length == 0 and process_agencies|length == 0 %}
                            <tr>
                                <td colspan="5" style="text-align: center; padding: 40px 0;">
                                    <div class="ts-blankslate is-large" style="border: none;">
                                        <span class="ts-icon is-file-circle-question-icon"></span>
                                        <div class="header">沒有機構資料</div>
                                        <div class="description">請按下上方的「新增機構」按鈕加入。</div>
                                    </div>
                                </td>
                            </tr>
                            {% endif %}
                        </tbody>
                    </table>
                </div>
            </div>

        </div>
    </div>
{% endblock %}

{% block scripts %}
    <script src="{% static 'js/dashboard_extension/location_management.js' %}"></script>
{% endblock %}