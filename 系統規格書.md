# 醫療廢棄物管理系統 - 系統規格書

## 1. 權限管理模組

系統須建立五級權限管理架構：

1. 根帳號：具備系統最高權限
2. 管理者：可管理使用者帳號
3. 行政人員：可進行日常業務操作
4. 登錄者：可進行資料登錄作業
5. 匯入者：可進行資料匯入作業

此外，系統須提供使用者註冊、帳號查詢、帳號刪除、密碼變更等基本管理功能。

## 2. 主畫面模組

系統須完成主畫面模組功能如下：

1. 系統須在主畫面上方顯示上個月廢棄物統計資料，統計數據須每月自動更新，無需手動干預
2. 系統須在主畫面中央設置四個分類按鈕，且須支援點擊切換功能，影響下方圖表顯示內容
3. 系統須在主畫面下方提供圖表展示區域，且圖表須顯示近12個月的廢棄物數據變化趨勢

## 3. 聯單管理模組

系統須完成聯單管理模組功能如下：

1. 系統須支援環保署清除單和再利用單兩種聯單類型管理
2. 系統須提供CSV檔案批量匯入功能，支援欄位自動識別對應
3. 系統須具備資料衝突檢測機制，提供略過、覆蓋、取消三種處理方式
4. 系統須提供聯單詳細資訊檢視功能，包含申報、清運、處理、回收等完整流程追蹤
5. 系統須支援多條件篩選功能：按聯單編號、類型、狀態、日期範圍等條件篩選
6. 系統須提供聯單批量刪除功能，並具備確認機制防止誤刪

## 4. 院內廢棄物管理模組

系統須完成廢棄物管理模組功能如下：

1. 系統須支援單筆資料新增和匯入兩種資料錄入方式
2. 系統須提供資料編輯功能，支援現有資料修改
3. 系統須具備資料刪除功能，支援單筆或批量刪除操作
4. 系統須支援多欄位篩選查詢功能
5. 系統須提供資料表選擇功能，支援不同類型廢棄物資料管理
6. 系統須具備檔案格式驗證和內容說明功能

## 5. 報表管理模組

報表管理模組包含基礎廢棄物產出報表和部門廢棄物可視化報表。

### 5.0 共通功能

兩個報表系統皆須具備以下功能：

1. 系統須提供引導式圖表生成流程：新增圖表、設定圖表類型與座標軸、新增數據線段、變更圖表主題與顯示設定
2. 系統須支援長條圖、折線圖、堆疊直條圖、圓餅圖等類型圖表生成功能
3. 系統須提供即時圖表預覽功能
4. 系統須具備圖表線段顏色調整、複製、刪除等編輯功能
5. 系統須支援報表標題設定
6. 系統須提供PNG、PDF、XLSX格式報表匯出功能
7. 系統須支援單位轉換功能：公斤與公噸互換
8. 系統須支援多圖表標籤頁管理，允許使用者同時建立多個圖表並切換檢視
9. 系統須支援圖表主題切換：深色模式與淺色模式
10. 系統須提供圖表最大化功能

### 5.1 基礎廢棄物產出報表

此報表系統專用於院內五種基礎廢棄物產出資料表的視覺化，與5.0共通功能的主要差異如下：

1. 資料來源為固定的五種廢棄物產出表（一般事業、生物醫療、洗腎桶軟袋、藥用玻璃、紙鐵鋁罐塑膠玻璃）
2. Y軸選項包含重量（公噸/公斤）、重量百分比、金額（新台幣）、金額百分比
3. X軸選項包含年份/季度/月份的總和或平均，以及「只有月份」選項
4. 線段設定時須選擇資料表格及該表格的特定欄位

### 5.2 部門廢棄物可視化報表

此報表系統專用於部門廢棄物記錄的視覺化，與5.0共通功能的主要差異如下：

1. 資料來源為動態的部門和廢棄物類型（從Department和WasteType資料表載入）
2. Y軸選項僅包含重量（公噸/公斤）和金額（新台幣）
3. X軸選項包含年份/季度/月份的總和或平均
4. 需選擇顯示方法：按部門顯示或按廢棄物類型顯示
5. 線段設定時須選擇部門或廢棄物類型（根據顯示方法而定）


## 6. 廢棄物預測模組

系統須完成廢棄物預測功能如下：

1. 系統須採用多變量線性回歸分析方法進行預測
2. 系統須實施四階段篩選法：共線性初步篩選、相關性篩選、統計顯著性篩選、共線性精細篩選
3. 系統須支援相關係數、p值、VIF值等統計指標計算
4. 系統須提供資料訓練集區間設定功能
5. 系統須支援預測因子資料CSV檔案匯入
6. 系統須提供預測結果展示，包含下月產量預測值、模型R²值、統計參數等
7. 系統須生成散佈圖矩陣視覺化分析結果
8. 系統須支援醫院營運因子管理
9. 系統須提供Z-score異常值檢測功能，自動移除極端值以提升預測準確度
10. 系統須支援線性回歸參數展示，包含斜率、截距、R²值

## 7. 部門與廢棄物類型管理模組

系統須提供部門與廢棄物類型的完整管理功能，包含新增、編輯、刪除、啟用/停用等操作。

### 7.1 部門管理功能

使用者操作流程如下：

1. 管理者進入「部門廢棄物資料表管理」頁面
2. 系統在左側顯示廢棄物種類列表
3. 使用者勾選一個廢棄物種類
4. 系統在右側顯示該廢棄物種類關聯的部門列表
5. 部門列表包含：
   - 部門名稱
   - 顯示順序
   - 啟用狀態
   - 建立時間
   - 更新時間
6. 使用者點擊「新增部門」按鈕
7. 系統顯示新增表單
8. 使用者輸入：
   - 部門名稱
   - 顯示順序（數字）
9. 使用者點擊確定
10. 系統儲存新部門並更新列表
11. 新部門預設為啟用狀態

## 8. 訪客模式

系統須提供訪客模式，允許未登入使用者瀏覽系統。
使用者操作流程如下：

1. 使用者進入登入頁面
2. 系統顯示登入表單和「以訪客身份使用」按鈕
3. 使用者點擊「以訪客身份使用」按鈕
4. 系統設定訪客會話標記
5. 系統導向主頁面
6. 系統在頂部導航列顯示「訪客模式」標示
7. 使用者可瀏覽以下頁面：
   - 主頁面
   - 報表管理頁面
   - 預測分析頁面（僅檢視）
8. 訪客模式下，以下功能受限：
   - 無法新增、編輯、刪除資料
   - 無法匯入資料
   - 無法匯出報表
   - 無法存取帳號管理功能
   - 無法存取聯單管理功能
9. 使用者點擊「登入」按鈕
10. 系統導向登入頁面
11. 使用者輸入帳號密碼登入
12. 系統清除訪客會話標記並建立正式會話

系統反應規範：

- 訪客模式須明確標示
- 受限功能須顯示提示訊息
- 訪客模式下的操作按鈕須停用或隱藏
- 訪客可隨時切換至登入頁面

## 9. 其他系統功能

### 9.3 權限控制系統

系統須根據使用者權限等級控制功能存取。

權限檢查流程：
1. 使用者嘗試存取某個頁面或功能
2. 系統檢查使用者的權限等級
3. 系統比對該頁面/功能要求的最低權限
4. 若使用者權限足夠，系統允許存取
5. 若使用者權限不足，系統執行以下動作之一：
   - 重定向至登入頁面（未登入）
   - 顯示「權限不足」錯誤訊息
   - 隱藏該功能按鈕或選單項目
6. 對於API請求，系統返回401或403錯誤碼

權限等級對應功能：
- 訪客（未登入）：僅可檢視部分頁面
- importer（匯入者）：可匯入聯單資料
- registrar（登錄者）：可新增、編輯廢棄物資料
- staff（行政人員）：可檢視所有頁面
- moderator（管理者）：可管理帳號、部門、廢棄物類型
- root（根帳號）：具備所有權限